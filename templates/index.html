<!DOCTYPE html>
<html>
<head>
    <title>Word Fantasy - Combate</title>
    <style>
        body {
            background: #0d0d0d;
            color: white;
            font-family: Arial;
            text-align: center;
        }

        .box {
            background: #1a1a1a;
            border: 1px solid #444;
            padding: 20px;
            margin: 20px auto;
            width: 60%;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            background: darkred;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background: red;
        }

        #log {
            text-align: left;
            height: 150px;
            overflow-y: auto;
            background: black;
            padding: 10px;
        }
    </style>
</head>
<body>

<h1>⚔️ WORD FANTASY ⚔️</h1>

<div class="box">
    <h2>Jogador</h2>
    HP: <span id="player_hp"></span><br>
    Defesa: <span id="player_def"></span><br>
    Poções: <span id="player_potions"></span>
</div>

<div class="box">
    <h2>Inimigo</h2>
    HP: <span id="enemy_hp"></span>
</div>

<div class="box">
    <button onclick="sendAction('attack')">Atacar</button>
    <button onclick="sendAction('potion')">Usar Poção</button>
    <button onclick="resetGame()">Reiniciar</button>
</div>

<div class="box">
    <h3>Log de Combate</h3>
    <div id="log"></div>
</div>

<script>

let player = {
    hp: 120,
    min_atk: 8,
    max_atk: 15,
    def: 4,
    luck: 5,
    potions: 3
};

let enemy = {
    hp: 100,
    min_atk: 6,
    max_atk: 12,
    def: 2
};

function updateUI() {
    document.getElementById("player_hp").innerText = player.hp;
    document.getElementById("player_def").innerText = player.def;
    document.getElementById("player_potions").innerText = player.potions;
    document.getElementById("enemy_hp").innerText = enemy.hp;
}

async function sendAction(action) {

    if (player.hp <= 0 || enemy.hp <= 0) return;

    const response = await fetch("/combat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            player: player,
            enemy: enemy,
            action: action
        })
    });

    const data = await response.json();

    player = data.player;
    enemy = data.enemy;

    updateUI();

    const logBox = document.getElementById("log");
    data.log.forEach(msg => {
        logBox.innerHTML += msg + "<br>";
    });

    logBox.scrollTop = logBox.scrollHeight;
}

function resetGame() {

    player = {
        hp: 120,
        min_atk: 8,
        max_atk: 15,
        def: 4,
        luck: 5,
        potions: 3
    };

    enemy = {
        hp: 100,
        min_atk: 6,
        max_atk: 12,
        def: 2
    };

    document.getElementById("log").innerHTML = "";

    updateUI();
}

updateUI();

</script>

</body>
</html>
